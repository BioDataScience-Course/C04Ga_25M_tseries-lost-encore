---
title: "Etude de l'impact du Covid-19 sur la mobilité en Wallonie"
author: "Yasmina Bourdan - Théodore Nica - Morjane Benzine - Lindsey Marissens Cueva"
format:
  html:
    code-fold: true
    code-tools: true
    toc: true
editor: visual
lang: fr


<!--# Ceci est un commentaire. -->

<!--% Ceci est une consigne. Ne jamais modifier ni déplacer les consignes dans le document ! -->

<!--% Complétez le titre et le nom des auteurs (auteur1, auteur2, auteur3 et auteur 4) dans l'entête YAML.-->

## Introduction et but

<!--% Rédigez une courte introduction de 3 ou 5 phrases qui présente vos données. Ajoutez une phrase de but. Vous devez citer la bibliographie en utilisant le formatage Markdown ad hoc et en incluant votre référence au format bibtex dans le fichier references.bib. -->

Ce carnet de notes a pour objectif d’explorer l’évolution de la mobilité des personnes en Wallonie avant et pendant la pandémie de COVID-19 à partir des données de mobilité fournies par Google. Il constitue un document de travail exploratoire dans lequel différentes méthodes d’analyse des séries spatio-temporelles sont testées et comparées. Les analyses présentées ici servent à identifier les structures temporelles, les tendances et les relations entre variables, afin de sélectionner les résultats les plus pertinents pour le rapport de synthèse. L’étude se concentre sur quatre paramètres de mobilité : les transports, les loisirs, le travail et la résidence.

Les données utilisées proviennent des Google COVID-19 Community Mobility Reports et sont fournies sous la forme du fichier mobility_wallonia.rds. Elles correspondent à des observations journalières exprimées en pourcentage de variation par rapport à une période de référence pré-pandémique. L’analyse porte sur quatre paramètres de mobilité jugés représentatifs des changements de comportement : les transports, les loisirs, le travail et la résidence. 

## Matériel et méthodes

<!--% Indiquez ici d'où viennent les données et aussi quel logiciel (et version) vous utilisez pour les analyses. Inspirez-vous des projets déjà réalisés. -->

...Matériel et méthodes...

## Analyses

<!--% Lisez bien les éléments devant guider votre analyse proposée dans le README.-->

```{r setup, include=FALSE}
# Nécessaire pour les tests SDD, ne pas utiliser dans un "vrai" projet
if (!"tools:tests" %in% search())
  source(here::here("tests/tools_tests.R"), attach(NULL, name = "tools:tests"))
# Configuration de l'environnement
SciViews::R("ts")
```

<!--% Ajoutez le nombre de chunks que vous souhaitez. Répartissez-vous le travail correctement. Structurez la section en partie avec des titres explicites de niveau trois.-->

```{r Importation mobility wallonia rds}

read("data/mobility_wallonia.rds") -> mob
mobw <- mob
mobw$weekdays <- weekdays(as.POSIXct(mobw$date))
mobw[mobw$weekdays == "Saturday" | mobw$weekdays == "Sunday", 2:7] <- NA # Contient que les 5 jours de la semaine
mobw_ts <- ts(mobw$retail_and_recreation_percent_change_from_baseline, start = c(2020, 46), frequency = 365)
mobw_ts2 <- aggregate(mobw_ts, 52, FUN = collapse::fmean, ts.eps = 1/52)

# Contient que le week-end
mobWE <- mob
mobWE$weekdays <- weekdays(as.POSIXct(mobWE$date))
mobWE[mobWE$weekdays != "Saturday" & mobWE$weekdays != "Sunday", 2:7] <- NA
mobWE_ts <- ts(mobWE$retail_and_recreation_percent_change_from_baseline, start = c(2020, 46), frequency = 365)
mobWE_ts2 <- aggregate(mobWE_ts, 52, FUN = collapse::fmean, ts.eps = 1/52)
```

##Mobilité lié aux Commerces et aux loisirs
###Présentation du jeux de données 

```{r loisir et commerce présentation des données}
# Série brut, semaine
mob_loisir_brut <- ts( mob$retail_and_recreation_percent_change_from_baseline, start = c(2020, 46), frequency = 365)
plot( mob_loisir_brut, main = "Commerces et loisirs - Semaine",  ylab = "% de changement par rapport à la référence", xlab = "Temps")

#Jours ouvrables
mobw_loisir_brut <- ts(mobw$retail_and_recreation_percent_change_from_baseline, start = c(2020, 46), frequency = 365)
plot(mobw_loisir_brut, main = "Commerces et loisirs - Jours ouvrables",ylab = "% de changement par rapport à la référence", xlab = "Temps")

#WE
mobWE_loisir_brut  <- ts(mobWE$retail_and_recreation_percent_change_from_baseline,   start = c(2020, 46), frequency = 365)
plot(mobWE_loisir_brut, main = "Commerces et loisirs - week-end uniquement", ylab = "% de changement par rapport à la référence", xlab = "Temps")

#Jours ouvrable et WE supperposé 
plot(mobw_loisir_brut, main = "Commerces et loisirs  – comparaison jours ouvrables / week-end ", xlab = "Temps", ylab = "% vs baseline", lwd = 2)
lines(mobWE_loisir_brut, lwd = 2, lty = 2)
legend("topright", legend = c("Jours ouvrables", "Week-end"), lty = c(1,2), lwd = 2, bty = "n")

```
L’analyse descriptive des séries temporelles de mobilité liées aux commerces et aux loisirs en Wallonie met en évidence une chute brutale et immédiate de la mobilité au début de l’année 2020, correspondant à la mise en place des premières mesures de confinement liées à la pandémie de COVID-19.
Cette diminution est observable dans les trois séries étudiées (série complète, jours ouvrables et week-ends), mais elle apparaît plus marquée durant les week-ends que pendant les jours ouvrables. En semaine, la baisse est également présente, mais elle est plus lissée, traduisant le maintien partiel de déplacements essentiels.
À partir de l’année 2021, une reprise progressive de la fréquentation des commerces et des loisirs est observée, bien que les niveaux de mobilité ne retrouvent pas ceux de la période de référence pré-pandémique.
La distinction entre jours ouvrables et week-ends met en évidence que les activités de loisirs ont été plus fortement affectées par la crise sanitaire qu’en semaine. 
Ces différences justifient l’utilisation des méthodes d’analyse statistique adaptées aux séries temporelles pour approfondir l’étude.


###Analyse : 
####Préparation des données 
```{r LOISIR Hebdomadaire }
#Jours ouvrables
mobwts_LOISIR <- ts(mobw$retail_and_recreation_percent_change_from_baseline, start = c(2020, 46), frequency = 365)
aggregate(mobwts_LOISIR, 52, FUN = collapse::fmean, ts.eps = 1/52) ->mobw_loisirs_ts
plot(mobw_loisirs_ts)
#Week-end
mobWEts_LOISIR <- ts(mobWE$retail_and_recreation_percent_change_from_baseline, start = c(2020, 46), frequency = 365)
aggregate(mobWEts_LOISIR, 52, FUN = collapse::fmean, ts.eps = 1/52) ->mobWE_loisirs_ts
plot(mobWE_loisirs_ts)

#semaine compléte
mobts_LOISIR <- ts(mob$retail_and_recreation_percent_change_from_baseline, start = c(2020, 46), frequency = 365)
aggregate(mobts_LOISIR, 52, FUN = collapse::fmean, ts.eps = 1/52) ->mob_loisirs_ts
plot(mob_loisirs_ts)

#Jours ouvrable et WE suppérposé 
plot(mobwts_LOISIR, main = "Commerces et loisirs  – comparaison jours ouvrables / week-end (hebdomadaire) ", xlab = "Temps", ylab = "% vs baseline", lwd = 2)
lines(mobWEts_LOISIR, lwd = 2, lty = 2)
legend("topright", legend = c("Jours ouvrables", "Week-end"), lty = c(1,2), lwd = 2, bty = "n")

```
Ici on a fait une  agrégation hebdomadaire, pour lisser la ts et la rendre plus lisible.On voit chute importante début 2020, puis une reprise progressive à partir de 2021 et une stabilisation relative ensuite.La ts week-end a une amplitude plus grande et presente  plus de variations. 
Et celle des jours ouvrables est un  peu plus lissée et moins extrême.

####Analyse statistique
```{r Autocorrélation LOISIR}
acf(mobw_loisirs_ts, main = "ACF – LOISIR (jours de semaine, hebdomadaire)")
acf(mobWE_loisirs_ts,main = "ACF – LOISIR (week-end, hebdomadaire)")
acf(mob_loisirs_ts,main = "ACF – LOISIR (série complète, hebdomadaire)")
```
On observe toujours une chute très marquée début 2020 (premier confinement),suivie d’une reprise progressive à partir de 2021. La chute est plus brutale et plus profonde le week-end et plus lissée les jours ouvrables. Les niveaux pré-pandémiques ne sont pas totalement retrouvés. 
Cela confirme que le secteur des loisirs a été durablement affecté par la crise sanitaire.

```{r tendance locale et générale de loisir}
trend.test(mobw_loisirs_ts, R=999)->trend.test_w_loisir
plot(trend.test_w_loisir)
trend.test_w_loisir
trend.test(mobWE_loisirs_ts, R=999)->trend.test_WE_loisir
plot(trend.test_WE_loisir)
trend.test_WE_loisir
trend.test(mob_loisirs_ts,R=999)->trend.test_loisir
plot(trend.test_loisir)
trend.test_loisir

local.trend(mobw_loisirs_ts,  main = "Tendance locale – LOISIR (jours ouvrables)")->local.trend_w_loisir
local.trend(mobWE_loisirs_ts, main = "Tendance locale – LOISIR (week-end)")->local.trend_WE_loisir
local.trend(mob_loisirs_ts, main = "Tendance locale – LOISIR (hebdomadaire)")->local.trend_loisir
```
L’analyse de la tendance locale met en évidence des changements au cours du temps. Une forte tendance négative est observée au début de la période étudiée, suivie d’un point bas autour de l’année 2021. Ensuite, une reprise progressive est visible, tant pour les jours ouvrables que pour les week-ends, bien que cette reprise soit plus marquée pour les activités de loisirs durant les week-ends.
Donc durant le confinement les gens vont moins au centre commerciaux et font moins de loisir, ce qui coïncide avec le confinement et après lors des réouverture la tendance augmente les gens ressortent aux magasins.
Les résultats du test de tendance générale basé sur bootstrap montrent que la statistique de test est significativement différente de zéro. La distribution bootstrap et le QQ-plot indiquent une bonne approximation par une loi normale, confirmant l’existence d’une tendance significative dans les séries de mobilité liées aux loisirs.

```{r loisir décomposition}
mobw_mm_loisir <- tsd(mobw_loisirs_ts, method = "average", order = 5, times = 3)
plot(mobw_mm_loisir)
mobWE_mm_loisir <- tsd(mobWE_loisirs_ts, method = "average", order = 5, times = 3)
plot(mobWE_mm_loisir)
mob_mm_loisir <- tsd(mob_loisirs_ts, method = "average", order = 5, times = 3)
plot(mob_mm_loisir)

```

La décomposition par moyenne mobile permet de séparer la série de mobilité liée aux commerces et aux loisirs en une composante de tendance et une composante résiduelle.
La composante filtrée met en évidence une tendance de long terme marquée par une chute brutale au début de l’année 2020, suivie d’une phase basse prolongée et d’une reprise progressive à partir de 2021. Cette évolution est observée de manière cohérente pour la série complète ainsi que pour les sous-séries jours ouvrables et week-end.
Les résidus sont globalement centrés autour de zéro et correspondent principalement à des fluctuations de court terme et à des chocs ponctuels, indiquant que la décomposition capture correctement la dynamique principale de la série.

La décomposition par moyenne mobile permet de séparer la série de mobilité liée aux commerces et aux loisirs en une composante de tendance et une composante résiduelle.
La composante filtrée met en évidence une tendance de long terme marquée par une chute brutale au début de l’année 2020, suivie d’une phase basse prolongée et d’une reprise progressive à partir de 2021. Cette évolution est observée de manière cohérente pour la série complète ainsi que pour les sous-séries jours ouvrables et week-end.
Les résidus sont globalement centrés autour de zéro et correspondent principalement à des fluctuations de court terme et à des chocs ponctuels, indiquant que la décomposition capture correctement la dynamique principale de la série.
```{r decomp_LOESS_loisir}
loisir_loess <- tsd(mob_loisirs_ts, method   = "loess", s.window = 53, trend    = TRUE, robust   = TRUE)
plot(loisir_loess, main = "Décomposition LOESS – LOISIR (hebdomadaire, série complète)")

loisir_loess_w <- tsd(mobw_loisirs_ts, method   = "loess", s.window = 53, trend    = TRUE, robust   = TRUE)
plot(loisir_loess_w, main = "Décomposition LOESS – LOISIR (jours ouvrables)")

loisir_loess_WE <- tsd(mobWE_loisirs_ts, method   = "loess", s.window = 53, trend    = TRUE, robust   = TRUE)
plot(loisir_loess_WE, main = "Décomposition LOESS – LOISIR (Week-end)")
```
La décomposition LOESS est privilégiée car elle capture correctement les tendances de long terme et les structures saisonnières sans imposer d’hypothèse linéaire stricte, tout en laissant des résidus faiblement structurés.
La COVID-19 a provoqué une rupture majeure dans la mobilité liée aux loisirs,
cet impact est visible à la fois sur la tendance de long terme et les variations à court terme,
tandis que la structure saisonnière persiste, bien que temporairement perturbée.
La décomposition LOESS est privilégiée car elle capture correctement les tendances de long terme et les structures saisonnières sans imposer d’hypothèse linéaire stricte, tout en laissant des résidus faiblement structurés.

```{r extraction des résidus }
mts_loisir <- tseries(loisir_loess)
plot(mts_loisir)

mts_loisir_w<- tseries(loisir_loess_w)
plot(mts_loisir_w)

tseries(loisir_loess_WE)->mts_loisir_WE
plot(mts_loisir_WE)

```
Les résidus sont très négatifs au début (dans les 3 cas), puis reviennent vers une zone plus stable.
La saisonnalité est bien visible et assez régulière.
La tendance monte puis forme un plateau vers la fin.
Et donc les restriction du confinnement ont fait que les gens fréquentaient moins les commerces et leurs loisirs et petit à petit ils ont put  reprendre leusr activité normalement.
```{r loisir autocorelation}
acf(mts_loisir[, "trend"])
acf(mts_loisir_w[, "trend"])
acf(mts_loisir_WE[, "trend"])
```
L’autocorrélation élevée et persistante de la composante de tendance indique une forte dépendance temporelle, confirmant le caractère non stationnaire de la série, principalement induit par la rupture structurelle associée à la pandémie de COVID-19.
```{r spectrum}
spectrum(mts_loisir[, "trend"], spans = c(5,7))
spectrum(mts_loisir_w[, "trend"], spans = c(5,7))
spectrum(mts_loisir_WE[, "trend"], spans = c(5,7))

```
Le spectre est fortement concentré aux basses fréquences. Il n’y a pas de pic marqué à des fréquences élevées. La puissance spectrale décroît rapidement quand la fréquence augmente.
Ce qui confirme que la tendance est dominée par des variations lentes, sans périodicité courte marquée.
Il n’y a pas de cycle régulier hebdomadaire ou saisonnier dans la tendance ils ont été correctement séparés dans la composante seasonal lors de la décomposition LOESS.
```{r loisir autorrelation}
acf(mts_loisir[, "residuals"])
acf(mts_loisir_w[, "residuals"])
acf(mts_loisir_WE[, "residuals"])

```
Les résidus ne sont pas 100% bruit blanc il reste une dépendance à court terme 
Ce qui est logique, parce que les mesures ne sont pas mise un seul jour, ça crée des épisodes de plusieurs jours/semaines donc autocorrélation.

Je garde la décomposition LOESS car elle capture une tendance non linéaire et robuste aux ruptures (chocs COVID), tout en séparant proprement la saisonnalité et les anomalies résiduelles.


##Mobilité lié au travail 
```{r TRAVAIL}
mobwts_travail <- ts(mobw$workplaces_percent_change_from_baseline, start = c(2020, 46), frequency = 365)
aggregate(mobwts_travail, 52, FUN = collapse::fmean, ts.eps = 1/52) ->mobw_travail_ts
plot(mobw_travail_ts)

mobWEts_travail <- ts(mobWE$workplaces_percent_change_from_baseline, start = c(2020, 46), frequency = 365)
aggregate(mobWEts_travail, 52, FUN = collapse::fmean, ts.eps = 1/52) ->mobWE_travail_ts
plot(mobWE_travail_ts)
```

```{r Autocorrélation TRAVAIL}
acf(mobw_travail_ts)
acf(mobWE_travail_ts)
```

## Mobilité lié à la résidence
### Présentation du jeu de données 
```{r visualisation données résidence brutes}
mob_ts_residence_brute <- ts(mob$residential_percent_change_from_baseline, start = c(2020, 46), frequency = 365)
plot(mob_ts_residence_brute, main = "Résidence – semaines entières", xlab = "Temps", ylab = "% changement vs référence") #Visualisation données résidence pour semaine complètes

mobw_ts_residence_brute <- ts(mobw$residential_percent_change_from_baseline, start = c(2020, 46), frequency = 365)
plot(mobw_ts_residence_brute, main = "Résidence – jours ouvrables", xlab = "Temps", ylab = "% changement vs référence") #Visualisation données résidence pour jours ouvrables

mobWE_ts_residence_brute <- ts(mobWE$residential_percent_change_from_baseline, start = c(2020, 46), frequency = 365)
plot(mobWE_ts_residence_brute, main = "Résidence – week-ends", xlab = "Temps", ylab = "% changement vs référence") #Visualisation données résidence pour week-ends

#Comparaison jours ouvrables et semaines 
plot(mobw_ts_residence_brute, main = "Résidence – comparaison jours ouvrables / week-end", xlab = "Temps", ylab = "% vs référence", lwd = 2)
lines(mobWE_ts_residence_brute, lwd = 2, lty = 2)
legend("topright", legend = c("Jours ouvrables", "Week-end"), lty = c(1,2), lwd = 2, bty = "n")

plot(mob$date, mob$residential_percent_change_from_baseline, type = "l", main = "Résidence – série temporelle avec séparation par années", ylab = "Variation (%) par rapport à la référence", xlab = "Date")
abline(v = as.Date(c("2021-01-01", "2022-01-01")), col = "blue", lty = 2) # Lignes verticales aux changements d'année
```
La variable Résidence représente la variation (en %) du temps passé à domicile par rapport à une période de référence. La série temporelle reprenant la semaine entière montre une hausse très marquée au début de l’année 2020, correspondant au premier confinement, avec des valeurs dépassant +30 %. 
Par la suite, la série présente une diminution progressive, ponctuée de fluctuations, traduisant l’alternance des mesures sanitaires en 2020 et 2021. À partir de 2022, les variations deviennent plus faibles et se rapprochent de la référence (0%).
La distinction entre jours ouvrables et week-ends met en évidence des comportements différents. Les jours ouvrables montrent des augmentations plus importantes et plus persistantes, probablement liées au télétravail, tandis que les week-ends montrent des variations plus modérées et un retour plus rapide vers les niveaux de référence.

### Analyses
#### Préparation des données 
```{r objet ts résidence}
mobts_residence <- ts(mob$residential_percent_change_from_baseline, start = c(2020, 46), frequency = 365)
aggregate(mobts_residence, 52, FUN = collapse::fmean, ts.eps = 1/52) ->mob_residence_ts
plot(mob_residence_ts) #objet ts reprenant la semaine entière

mobwts_residence <- ts(mobw$residential_percent_change_from_baseline, start = c(2020, 46), frequency = 365)
aggregate(mobwts_residence, 52, FUN = collapse::fmean, ts.eps = 1/52) ->mobw_residence_ts
plot(mobw_residence_ts) #objet ts reprenant les jours ouvrables

mobWEts_residence <- ts(mobWE$residential_percent_change_from_baseline, start = c(2020, 46), frequency = 365)
aggregate(mobWEts_residence, 52, FUN = collapse::fmean, ts.eps = 1/52) ->mobWE_residence_ts
plot(mobWE_residence_ts) #objet ts reprenant les week-ends

plot(mobw_residence_ts, main = "Résidence – comparaison jours ouvrables / week-end", xlab = "Temps", ylab = "Variation (%) vs référence", lwd = 2)
lines(mobWE_residence_ts, lwd = 2, lty = 2)
legend("topright", legend = c("Jours ouvrables", "Week-end"), lty = c(1,2), lwd = 2, bty = "n")
```
Les données de la variable résidence ont été converties en objets de type ts afin de permettre l’application des méthodes d’analyse des séries temporelles. Les séries sont définies à une fréquence journalière (frequency = 365) avec un point de départ fixé au 46ᵉ jour de l’année 2020.
Trois séries ont été construites : une série incluant l’ensemble des jours, une série limitée aux jours ouvrables et une série limitée aux week-ends. 

#### Dépendance temporelle et autocorrélation
```{r Autocorrélation résidence}
acf(mob_residence_ts, main = "ACF – Résidence (semaines complètes)")
acf(mobw_residence_ts, main = "ACF – Résidence (jours ouvrables)")
acf(mobWE_residence_ts, main = "ACF – Résidence (week-ends)")
```
L’ACF calculée sur les semaines complètes confirme ces observations, avec une autocorrélation significative sur plusieurs retards, reflétant la dynamique globale de la variable Résidence.
Pour les jours ouvrables, l’ACF montre des valeurs élevées aux petits retards, suivies d’une décroissance progressive. Cette structure indique une forte dépendance temporelle et suggère la présence d’une composante de long terme dans la série.
La série correspondant aux week-ends présente un comportement similaire, avec une autocorrélation initiale élevée et une décroissance plus lente, traduisant également une persistance temporelle marquée.
Dans l’ensemble, ces résultats indiquent que les observations successives ne sont pas indépendantes et que les séries ne peuvent être considérées comme stationnaires, ce qui justifie l’analyse des tendances et la décomposition des séries temporelles dans la suite du travail.

#### Analyses des tendances
```{r tendance générale et locale résidence}
set.seed(123)
tt_residence <- trend.test(mob_residence_ts, R = 999)
tt_residence
plot(tt_residence)
lt_residence <- local.trend(mob_residence_ts, main="Test de tendance locale - résidence - semaines entières")

tt_residence_w <- trend.test(mobw_residence_ts, R = 999)
tt_residence_w
plot(tt_residence_w)
lt_residence_w <- local.trend(mobw_residence_ts, main="Test de tendance locale - résidence - jours ouvrables")

tt_residence_WE <- trend.test(mobWE_residence_ts, R = 999)
tt_residence_WE
plot(tt_residence_WE)
lt_residence_WE <- local.trend(mobWE_residence_ts, main="Test de tendance locale - résidence - week-ends") 
```
Le test de tendance globale, appliqué aux 3 séries indique que l’hypothèse d’absence de tendance peut être rejetée. L’évolution observée ne peut donc pas être attribuée uniquement à des fluctuations aléatoires, ce qui confirme la présence d’une composante de long terme dans la série. Pour les semaines complètes et les jours ouvrables, une augmentation marquée est observée au début de l’année 2020, suivie d’un maintien à des niveaux élevés au cours de l’année 2021, puis d’une diminution progressive à partir de 2021–2022. 
La série correspondant aux week-ends présente une évolution similaire, mais avec des amplitudes plus faibles, suggérant un impact moins durable sur les comportements résidentiels durant ces périodes.

#### Décomposition de la série temporelle et extraction 
```{r décomposition résidence}
mob_mm_residence <- tsd(mob_residence_ts, method = "average", order = 5, times = 3)
plot(mob_mm_residence)

mobw_mm_residence <- tsd(mobw_residence_ts, method = "average", order = 5, times = 3)
plot(mobw_mm_residence)

mobWE_mm_residence <- tsd(mobWE_residence_ts, method = "average", order = 5, times = 3)
plot(mobWE_mm_residence)

residencew_filtered <- extract(mobw_mm_residence, components = "filtered")
plot(residencew_filtered,
     main = "Résidence – composante filtrée (moyenne mobile)",
     xlab = "Temps", ylab = "Variation (%) vs référence")


residencew_filtered <- extract(mobw_mm_residence, components = "filtered")

acf(residencew_filtered, main = "ACF de la composante filtrée – Résidence (jours ouvrables)")

```
La décomposition de la série temporelle de la variable Résidence a été réalisée afin d’isoler la dynamique de long terme et de séparer cette composante des fluctuations de court terme. Pour les semaines complètes, les jours ouvrables et les week-ends, les résultats montrent une dynamique globalement similaire : la série observée présente une hausse marquée au début de la période, suivie d’une décroissance progressive, ponctuée de quelques reprises intermédiaires.

La composante filtrée, extraite par moyenne mobile, met clairement en évidence cette évolution de fond en réduisant la variabilité de court terme, ce qui facilite la lecture de la tendance générale et la comparaison entre périodes. Les résidus sont globalement centrés autour de zéro, mais présentent des valeurs extrêmes plus importantes au début de la période ainsi que lors de certains épisodes ponctuels, traduisant des variations temporaires non expliquées par la tendance lissée.

La séparation selon le type de jour confirme que la dynamique de long terme est commune aux trois séries, tout en suggérant des amplitudes plus marquées pour les jours ouvrables et plus modérées pour les week-ends.




```{r TRANSPORT - Presentation de données sur les arrets de transport en époque de Covid}
mob_ts_transport_brut <- ts(mobw$transit_stations_percent_change_from_baseline, start = c(2020, 46), frequency = 365) 
mob_ts_transport<-aggregate(mob_ts_transport_brut, 52, FUN = collapse::fmean, ts.eps = 1/52) 
plot(mob_ts_transport, main="Arrets de transport par semaine",xlab="Temps", ylab="Pourcentage de changement par rapport à la référence") #pour la semaine complète 

mobDS_ts_transport_brut <- ts(mobWE$transit_stations_percent_change_from_baseline, start = c(2020, 46), frequency = 365) 
mobDS_ts_transport<-aggregate(mobDS_ts_transport_brut, 52, FUN = collapse::fmean, ts.eps = 1/52) 
plot(mobDS_ts_transport, main = "Arrêts de transport en Début de Semaine", xlab = "Temps", ylab = "Pourcentage de changement par rapport à la référence")#pour le début de semaine de lundi à vendredi 

mobFS_ts_transport_brut <- ts(mob$transit_stations_percent_change_from_baseline, start = c(2020, 46), frequency = 365) 
mobFS_ts_transport<-aggregate(mobFS_ts_transport_brut, 52, FUN = collapse::fmean, ts.eps = 1/52) 
plot(mobFS_ts_transport, main = "Arrêts de transport en Fin de Semaine", xlab = "Temps", ylab = "Pourcentage de changement par rapport à la référence")#pour la fin de la semaine pendant le samedi et le dimanche 

plot(mob_ts_transport_brut, main = "Comparaison entre le Début de semaine et la Fin de la semaine", xlab = "Temps", ylab = "Pourcentage contre baseline", lwd = 2) 
lines(mob_ts_transport_brut, lwd = 2, lty = 0.5) 
legend("topright", legend = c("Début Semaine", "Fin Semaine"), lty = c(1,2), lwd = 0.5, bty = "n")#Superposition de début de semaine et fin de semaine  
```

On peut voir qu'au début du 2020 il y a une forte diminution, mais très peu après il y a une grande augmentation successive. En 2021, il y à nouveau une chute mais beaucoup moins drastique qu'avant (1/2 par rapport à l'année dernière). Ensuite, on voit une récupération encore plus forte qu'avant. Cependant, en 2022 il y a encore une autre chute de même intensité or qui dure beaucoup moins longtemps. Cette fois ci on perçoit une récupération complète de quasi 60% qui est maintenu dans le temps.

```{r Autocorrélation TRANSPORT}
acf(mob_ts_transport, main = "ACF – TRANSPORT (tous les jours de la semaine, hebdomadaire)") 
acf(mobDS_ts_transport,main = "ACF – TRANSPORT (Début semaine, hebdomadaire)") 
acf(mobFS_ts_transport,main = "ACF – TRANSPORT (Fin Semaine, hebdomadaire)")  
```

```{r tendance locale et générale dans les arrêts de transport}
trend.test(mob_ts_transport, R=999)->trend.test_S_transport 
plot(trend.test_S_transport) 
trend.test_S_transport 

trend.test(mobDS_ts_transport, R=999)->trend.test_DS_transport
plot(trend.test_DS_transport) 
trend.test_DS_transport 

trend.test(mobFS_ts_transport,R=999)->trend.test_FS_transport 
plot(trend.test_FS_transport) 
trend.test_FS_transport 

local.trend(mob_ts_transport, main = "Tendance locale – TRANSPORT (jours ouvrables)")->local.trend_transport 
local.trend(mobDS_ts_transport, main = "Tendance locale – TRANSPORT (week-end)")->local.trend_DS_transport 
local.trend(mobFS_ts_transport, main = "Tendance locale – TRANSPORT (hebdomadaire)")->local.trend_FS_transport  

```

```{r décomposition de données de arrêts de Transport}
mob_mm_transport <- tsd(mob_ts_transport, method = "average", order = 5, times = 3) 
plot(mob_mm_transport) 

mobDS_mm_transport <- tsd(mobDS_ts_transport, method = "average", order = 5, times = 3) 
plot(mobDS_mm_transport) 

mobFS_mm_transport <- tsd(mobFS_ts_transport, method = "average", order = 5, times = 3) 
plot(mobFS_mm_transport)  
```

```{r decomposition en LOESS des arrêts de transport}
transport_loess <- tsd(mob_ts_transport, method = "loess", s.window = 53, trend = TRUE, robust = TRUE) 
plot(transport_loess, main = "Décomposition LOESS de TRANSPORT (semaine complète)") 

transportDS_loess <- tsd(mobDS_ts_transport, method = "loess", s.window = 53, trend = TRUE, robust = TRUE) 
plot(transportDS_loess, main = "Décomposition LOESS de TRANSPORT (Debut de semaine: de lundi à vendredi)") 

transportFS_loess <- tsd(mobFS_ts_transport, method = "loess", s.window = 53, trend = TRUE, robust = TRUE) 
plot(transportFS_loess, main = "Décomposition LOESS de TRANSPORT (Fin de semaine: samedi et dimanche)")  
```

```{r extraction des résidus de Transport }
mts_transport <- tseries(transport_loess) 
plot(mts_loisir) 

mts_transportDS <- tseries(transportDS_loess) 
plot(mts_transportDS) 

mts_transportFS <- tseries(transportFS_loess) 
plot(mts_transportFS)  
```

```{r autocorrélation transport}
acf(mts_transport[, "trend"]) 
acf(mts_transportDS[, "trend"]) 
acf(mts_transportFS[, "trend"])  
```

```{r spectrum transport}
spectrum(mts_transport[, "trend"], spans = c(5,7)) 
spectrum(mts_transportDS[, "trend"], spans = c(5,7)) 
spectrum(mts_transportFS[, "trend"], spans = c(5,7))  
```

```{r autocorrélation transport}
acf(mts_transport[, "residuals"]) 
acf(mts_transportDS[, "residuals"]) 
acf(mts_transportFS[, "residuals"])  
```

## Conclusion

<!--% Lorsque toutes les analyses sont réalisées, terminez ce bloc-notes avec 3 à 6 phrases de conclusion en rapport avec ce que vous avez observé dans vos analyses. Quels sont les éléments les plus pertinents que vous retenez ? -->

...vos conclusions ici...
